<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knight's Rest - A Meditation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background: #0a0a0a;
            color: #e8d4a8;
            min-height: 100vh;
            overflow: hidden;
        }

        #app {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main background image */
        #scene-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('knight-bg.png') center center / cover no-repeat;
            background-color: #0a0a0a;
            z-index: 1;
        }

        /* Vignette overlay for depth */
        #vignette {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.7) 100%);
            z-index: 2;
            pointer-events: none;
        }

        /* Fire glow effect */
        #fire-glow {
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            height: 400px;
            background: radial-gradient(
                ellipse at center,
                rgba(255, 120, 40, 0.15) 0%,
                rgba(255, 80, 20, 0.08) 40%,
                transparent 70%
            );
            z-index: 3;
            pointer-events: none;
            animation: glowPulse 3s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { opacity: 0.7; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
        }

        /* Embers canvas */
        #embers {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 4;
            pointer-events: none;
        }

        /* Quote display */
        #quote-container {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            text-align: center;
            max-width: 90%;
            width: 700px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
        }

        #quote {
            font-size: 11px;
            line-height: 2;
            color: #f0e0c0;
            text-shadow: 0 0 10px rgba(255, 150, 80, 0.4);
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }

        #quote.visible {
            opacity: 1;
        }

        /* Sound control */
        #sound-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(255, 150, 80, 0.3);
            color: #e8d4a8;
            padding: 10px 15px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #sound-btn:hover {
            background: rgba(40, 30, 20, 0.8);
            border-color: rgba(255, 150, 80, 0.6);
        }

        /* Click to start overlay */
        #start-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: opacity 0.8s ease;
        }

        #start-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #start-overlay h1 {
            font-size: 20px;
            margin-bottom: 30px;
            color: #ff9654;
            text-shadow: 0 0 20px rgba(255, 150, 80, 0.5);
            animation: titleGlow 2s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 20px rgba(255, 150, 80, 0.5); }
            50% { text-shadow: 0 0 40px rgba(255, 150, 80, 0.8); }
        }

        #start-overlay p {
            font-size: 10px;
            color: #8888aa;
            animation: blink 1.5s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Title in corner */
        #title {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10;
            font-size: 10px;
            color: #6a5a4a;
            opacity: 0.7;
        }

        /* Responsive */
        @media (max-width: 600px) {
            #quote {
                font-size: 9px;
                line-height: 1.8;
            }
            #quote-container {
                bottom: 40px;
                padding: 15px;
            }
            #start-overlay h1 {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="scene-bg"></div>
        <div id="vignette"></div>
        <div id="fire-glow"></div>
        <canvas id="embers"></canvas>
        
        <div id="quote-container">
            <p id="quote"></p>
        </div>
        
        <button id="sound-btn">üîä SOUND</button>
        <div id="title">Knight's Rest</div>
    </div>

    <div id="start-overlay">
        <h1>‚öîÔ∏è Knight's Rest ‚öîÔ∏è</h1>
        <p>~ Click anywhere to begin ~</p>
    </div>

    <script>
        // Meditation quotes
        const quotes = [
            "Even the mightiest hero must rest by the fire.",
            "Your quest continues tomorrow. Tonight, you heal.",
            "The campfire asks nothing of you. Just breathe.",
            "In the warmth of the flames, let your burdens fade.",
            "A true adventurer knows when to lay down their sword.",
            "No monster lurks here. Only peace, only warmth.",
            "Your HP restores with each gentle breath.",
            "The night is long, but the fire keeps watch.",
            "Even the bravest knight seeks the comfort of still moments.",
            "Let the crackling flames quiet your restless mind.",
            "You have fought well. Now, simply exist.",
            "The embers rise like your worries... and drift away.",
            "In this safe haven, time moves slowly.",
            "Your inventory is full of memories. Set them down awhile.",
            "The campfire's song is the only quest for now.",
            "Rest is not weakness. It is wisdom.",
            "The dungeon can wait. This moment cannot.",
            "Breathe in the night air. Exhale the battles of the day.",
            "You are exactly where you need to be, brave one.",
            "Bonfire lit. You are safe now."
        ];

        let currentQuoteIndex = 0;
        let audioStarted = false;
        let soundOn = true;
        let audioCtx = null;
        let masterGain = null;
        const quoteEl = document.getElementById('quote');
        const soundBtn = document.getElementById('sound-btn');
        const startOverlay = document.getElementById('start-overlay');
        const embersCanvas = document.getElementById('embers');
        const embersCtx = embersCanvas.getContext('2d');

        // Resize handling
        function resizeCanvas() {
            embersCanvas.width = window.innerWidth;
            embersCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Embers system
        const embers = [];
        function spawnEmber() {
            const centerX = embersCanvas.width / 2;
            const centerY = embersCanvas.height * 0.55;
            embers.push({
                x: centerX + (Math.random() - 0.5) * 80,
                y: centerY,
                vx: (Math.random() - 0.5) * 0.8,
                vy: -Math.random() * 2 - 1,
                life: 1,
                decay: Math.random() * 0.006 + 0.003,
                size: Math.random() * 3 + 1.5
            });
        }

        function updateEmbers() {
            for (let i = embers.length - 1; i >= 0; i--) {
                const e = embers[i];
                e.x += e.vx + Math.sin(e.y * 0.03) * 0.5;
                e.y += e.vy;
                e.vy *= 0.99;
                e.life -= e.decay;
                if (e.life <= 0) embers.splice(i, 1);
            }
        }

        function drawEmbers() {
            embersCtx.clearRect(0, 0, embersCanvas.width, embersCanvas.height);
            embers.forEach(e => {
                const gradient = embersCtx.createRadialGradient(e.x, e.y, 0, e.x, e.y, e.size * 2);
                gradient.addColorStop(0, `rgba(255, 200, 100, ${e.life})`);
                gradient.addColorStop(0.5, `rgba(255, 100, 30, ${e.life * 0.6})`);
                gradient.addColorStop(1, 'transparent');
                embersCtx.fillStyle = gradient;
                embersCtx.beginPath();
                embersCtx.arc(e.x, e.y, e.size * 2, 0, Math.PI * 2);
                embersCtx.fill();
            });
        }

        // Web Audio API ambient sound
        function initAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            masterGain = audioCtx.createGain();
            masterGain.gain.value = 0.35;
            masterGain.connect(audioCtx.destination);
            createAmbientPad();
            createWind();
            setInterval(() => {
                if (audioCtx && soundOn && Math.random() > 0.3) createCrackle();
            }, 300 + Math.random() * 400);
        }

        function createAmbientPad() {
            const frequencies = [146.83, 220, 293.66, 369.99];
            frequencies.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                const filter = audioCtx.createBiquadFilter();
                osc.type = 'sine';
                osc.frequency.value = freq;
                osc.detune.value = (Math.random() - 0.5) * 10;
                filter.type = 'lowpass';
                filter.frequency.value = 800;
                filter.Q.value = 0.5;
                gain.gain.value = 0.04 - (i * 0.005);
                const lfo = audioCtx.createOscillator();
                const lfoGain = audioCtx.createGain();
                lfo.frequency.value = 0.1 + Math.random() * 0.1;
                lfoGain.gain.value = 0.01;
                lfo.connect(lfoGain);
                lfoGain.connect(gain.gain);
                lfo.start();
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(masterGain);
                osc.start();
            });
        }

        function createWind() {
            const bufferSize = audioCtx.sampleRate * 4;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const output = buffer.getChannelData(0);
            let lastOut = 0;
            for (let i = 0; i < bufferSize; i++) {
                const white = Math.random() * 2 - 1;
                output[i] = (lastOut + (0.02 * white)) / 1.02;
                lastOut = output[i];
                output[i] *= 2;
            }
            const windSource = audioCtx.createBufferSource();
            windSource.buffer = buffer;
            windSource.loop = true;
            const windFilter = audioCtx.createBiquadFilter();
            windFilter.type = 'lowpass';
            windFilter.frequency.value = 300;
            const windGain = audioCtx.createGain();
            windGain.gain.value = 0.08;
            windSource.connect(windFilter);
            windFilter.connect(windGain);
            windGain.connect(masterGain);
            windSource.start();
        }

        function createCrackle() {
            if (!audioCtx) return;
            const bufferSize = audioCtx.sampleRate * 0.1;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const output = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                const t = i / bufferSize;
                const envelope = Math.exp(-t * 20);
                output[i] = (Math.random() * 2 - 1) * envelope * 0.3;
            }
            const source = audioCtx.createBufferSource();
            source.buffer = buffer;
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.value = 2000 + Math.random() * 2000;
            filter.Q.value = 1;
            const gain = audioCtx.createGain();
            gain.gain.value = 0.03 + Math.random() * 0.02;
            source.connect(filter);
            filter.connect(gain);
            gain.connect(masterGain);
            source.start();
        }

        // Quote rotation
        function showNextQuote() {
            quoteEl.classList.remove('visible');
            setTimeout(() => {
                currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
                quoteEl.textContent = quotes[currentQuoteIndex];
                quoteEl.classList.add('visible');
            }, 1500);
        }

        // Animation loop
        let lastEmberTime = 0;
        function animate(time) {
            if (time - lastEmberTime > 150) {
                if (Math.random() > 0.4) spawnEmber();
                lastEmberTime = time;
            }
            updateEmbers();
            drawEmbers();
            requestAnimationFrame(animate);
        }

        // Sound controls
        soundBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            soundOn = !soundOn;
            if (soundOn && masterGain) {
                masterGain.gain.value = 0.35;
                soundBtn.textContent = 'üîä SOUND';
            } else if (masterGain) {
                masterGain.gain.value = 0;
                soundBtn.textContent = 'üîá MUTED';
            }
        });

        // Start experience
        function startExperience() {
            startOverlay.classList.add('hidden');
            if (!audioStarted) {
                try {
                    initAudio();
                    audioStarted = true;
                } catch (e) {
                    soundBtn.textContent = 'üîá MUTED';
                    soundOn = false;
                }
            }
            quoteEl.textContent = quotes[0];
            setTimeout(() => quoteEl.classList.add('visible'), 500);
            setInterval(showNextQuote, 9000);
        }

        startOverlay.addEventListener('click', startExperience);
        document.addEventListener('keydown', (e) => {
            if (!startOverlay.classList.contains('hidden')) startExperience();
        });

        // Start animation
        requestAnimationFrame(animate);
    </script>
</body>
</html>
