<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knight's Rest - A Meditation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background: #0a0a12;
            color: #e8d4a8;
            min-height: 100vh;
            overflow: hidden;
            cursor: default;
        }

        #app {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Sky gradient background */
        #sky {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                #0a0a18 0%,
                #0f1428 30%,
                #1a1a2e 60%,
                #16213e 100%
            );
            z-index: 0;
        }

        /* Stars canvas */
        #stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Main scene canvas */
        #scene {
            position: relative;
            z-index: 2;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* Embers canvas */
        #embers {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            pointer-events: none;
        }

        /* Fire glow overlay */
        #glow {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            height: 400px;
            background: radial-gradient(
                ellipse at center bottom,
                rgba(255, 120, 50, 0.15) 0%,
                rgba(255, 80, 30, 0.08) 30%,
                transparent 70%
            );
            z-index: 4;
            pointer-events: none;
            animation: glowPulse 2s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { opacity: 0.8; transform: translateX(-50%) scale(1); }
            50% { opacity: 1; transform: translateX(-50%) scale(1.05); }
        }

        /* Quote display */
        #quote-container {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            text-align: center;
            max-width: 90%;
            width: 700px;
        }

        #quote {
            font-size: 12px;
            line-height: 2;
            color: #e8d4a8;
            text-shadow: 
                0 0 10px rgba(255, 150, 80, 0.5),
                2px 2px 0 #1a1a2e;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }

        #quote.visible {
            opacity: 1;
        }

        /* Sound control */
        #sound-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(26, 26, 46, 0.8);
            border: 2px solid #3a3a5e;
            color: #e8d4a8;
            padding: 10px 15px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #sound-btn:hover {
            background: rgba(58, 58, 94, 0.9);
            border-color: #ff9654;
        }

        /* Click to start overlay */
        #start-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 18, 0.95);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: opacity 0.5s ease;
        }

        #start-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #start-overlay h1 {
            font-size: 24px;
            margin-bottom: 30px;
            color: #ff9654;
            text-shadow: 0 0 20px rgba(255, 150, 80, 0.5);
            animation: titleGlow 2s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 20px rgba(255, 150, 80, 0.5); }
            50% { text-shadow: 0 0 40px rgba(255, 150, 80, 0.8); }
        }

        #start-overlay p {
            font-size: 10px;
            color: #8888aa;
            animation: blink 1.5s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Title in corner */
        #title {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10;
            font-size: 10px;
            color: #5a5a7a;
            opacity: 0.6;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            #quote {
                font-size: 9px;
                line-height: 1.8;
            }
            #start-overlay h1 {
                font-size: 16px;
            }
            #start-overlay p {
                font-size: 8px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="sky"></div>
        <canvas id="stars"></canvas>
        <canvas id="scene"></canvas>
        <canvas id="embers"></canvas>
        <div id="glow"></div>
        
        <div id="quote-container">
            <p id="quote"></p>
        </div>
        
        <button id="sound-btn">üîä SOUND</button>
        <div id="title">Knight's Rest</div>
    </div>

    <div id="start-overlay">
        <h1>‚öîÔ∏è Knight's Rest ‚öîÔ∏è</h1>
        <p>~ Click anywhere to begin ~</p>
    </div>

    <audio id="ambient-audio" loop preload="auto">
        <source src="https://ia800502.us.archive.org/5/items/MedievalTavernAmbience/Medieval%20Tavern%20Ambience.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Meditation quotes
        const quotes = [
            "Even the mightiest hero must rest by the fire.",
            "Your quest continues tomorrow. Tonight, you heal.",
            "The campfire asks nothing of you. Just breathe.",
            "In the warmth of the flames, let your burdens fade.",
            "A true adventurer knows when to lay down their sword.",
            "The stars watch over you. Rest, weary traveler.",
            "No monster lurks here. Only peace, only warmth.",
            "Your HP restores with each gentle breath.",
            "The night is long, but the fire keeps watch.",
            "Even the bravest knight seeks the comfort of still moments.",
            "Let the crackling flames quiet your restless mind.",
            "You have fought well. Now, simply exist.",
            "The embers rise like your worries... and drift away.",
            "In this safe haven, time moves slowly.",
            "Your inventory is full of memories. Set them down awhile.",
            "The campfire's song is the only quest for now.",
            "Rest is not weakness. It is wisdom.",
            "The dungeon can wait. This moment cannot.",
            "Breathe in the night air. Exhale the battles of the day.",
            "You are exactly where you need to be, brave one."
        ];

        let currentQuoteIndex = 0;
        let audioStarted = false;
        let soundOn = true;
        const audio = document.getElementById('ambient-audio');
        const quoteEl = document.getElementById('quote');
        const soundBtn = document.getElementById('sound-btn');
        const startOverlay = document.getElementById('start-overlay');

        // Initialize canvases
        const starsCanvas = document.getElementById('stars');
        const sceneCanvas = document.getElementById('scene');
        const embersCanvas = document.getElementById('embers');
        const starsCtx = starsCanvas.getContext('2d');
        const sceneCtx = sceneCanvas.getContext('2d');
        const embersCtx = embersCanvas.getContext('2d');

        // Resize handling
        function resizeCanvases() {
            starsCanvas.width = window.innerWidth;
            starsCanvas.height = window.innerHeight;
            embersCanvas.width = window.innerWidth;
            embersCanvas.height = window.innerHeight;
            
            // Scene canvas is smaller, centered
            const scale = Math.min(window.innerWidth / 400, window.innerHeight / 300, 2);
            sceneCanvas.width = 320;
            sceneCanvas.height = 240;
            sceneCanvas.style.width = (320 * scale) + 'px';
            sceneCanvas.style.height = (240 * scale) + 'px';
        }

        // Stars
        const stars = [];
        function initStars() {
            stars.length = 0;
            for (let i = 0; i < 150; i++) {
                stars.push({
                    x: Math.random() * starsCanvas.width,
                    y: Math.random() * starsCanvas.height * 0.7,
                    size: Math.random() * 2 + 0.5,
                    twinkleSpeed: Math.random() * 0.02 + 0.01,
                    twinkleOffset: Math.random() * Math.PI * 2
                });
            }
        }

        function drawStars(time) {
            starsCtx.clearRect(0, 0, starsCanvas.width, starsCanvas.height);
            stars.forEach(star => {
                const brightness = 0.3 + 0.7 * Math.abs(Math.sin(time * star.twinkleSpeed + star.twinkleOffset));
                starsCtx.fillStyle = `rgba(255, 255, 240, ${brightness})`;
                starsCtx.beginPath();
                starsCtx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                starsCtx.fill();
            });
        }

        // Embers
        const embers = [];
        function spawnEmber() {
            const centerX = embersCanvas.width / 2;
            const centerY = embersCanvas.height * 0.6;
            embers.push({
                x: centerX + (Math.random() - 0.5) * 60,
                y: centerY,
                vx: (Math.random() - 0.5) * 0.5,
                vy: -Math.random() * 1.5 - 0.5,
                life: 1,
                decay: Math.random() * 0.008 + 0.004,
                size: Math.random() * 3 + 1
            });
        }

        function updateEmbers() {
            for (let i = embers.length - 1; i >= 0; i--) {
                const e = embers[i];
                e.x += e.vx + Math.sin(e.y * 0.05) * 0.3;
                e.y += e.vy;
                e.life -= e.decay;
                if (e.life <= 0) {
                    embers.splice(i, 1);
                }
            }
        }

        function drawEmbers() {
            embersCtx.clearRect(0, 0, embersCanvas.width, embersCanvas.height);
            embers.forEach(e => {
                const gradient = embersCtx.createRadialGradient(e.x, e.y, 0, e.x, e.y, e.size * 2);
                gradient.addColorStop(0, `rgba(255, 200, 100, ${e.life})`);
                gradient.addColorStop(0.5, `rgba(255, 120, 50, ${e.life * 0.5})`);
                gradient.addColorStop(1, 'transparent');
                embersCtx.fillStyle = gradient;
                embersCtx.beginPath();
                embersCtx.arc(e.x, e.y, e.size * 2, 0, Math.PI * 2);
                embersCtx.fill();
            });
        }

        // Pixel art drawing helpers
        function drawPixel(ctx, x, y, color, size = 1) {
            ctx.fillStyle = color;
            ctx.fillRect(x * 4, y * 4, 4 * size, 4 * size);
        }

        // Draw ground
        function drawGround() {
            const groundY = 52;
            // Grass/ground colors
            const groundColors = ['#1a2418', '#1e2a1c', '#22301f', '#182015'];
            
            for (let x = 0; x < 80; x++) {
                const color = groundColors[Math.floor(Math.random() * groundColors.length)];
                for (let y = groundY; y < 60; y++) {
                    drawPixel(sceneCtx, x, y, y === groundY ? '#2a3a28' : color);
                }
            }
        }

        // Draw knight (sitting position)
        function drawKnight(frame) {
            const kx = 25; // Knight position
            const ky = 42;
            
            // Helmet
            drawPixel(sceneCtx, kx + 1, ky, '#5a6a78');
            drawPixel(sceneCtx, kx + 2, ky, '#5a6a78');
            drawPixel(sceneCtx, kx, ky + 1, '#4a5a68');
            drawPixel(sceneCtx, kx + 1, ky + 1, '#6a7a88');
            drawPixel(sceneCtx, kx + 2, ky + 1, '#6a7a88');
            drawPixel(sceneCtx, kx + 3, ky + 1, '#4a5a68');
            
            // Visor / face area
            drawPixel(sceneCtx, kx + 1, ky + 2, '#3a3a3a');
            drawPixel(sceneCtx, kx + 2, ky + 2, '#3a3a3a');
            
            // Body/armor (sitting)
            drawPixel(sceneCtx, kx, ky + 3, '#4a5a68');
            drawPixel(sceneCtx, kx + 1, ky + 3, '#5a6a78');
            drawPixel(sceneCtx, kx + 2, ky + 3, '#5a6a78');
            drawPixel(sceneCtx, kx + 3, ky + 3, '#4a5a68');
            
            // Cape
            drawPixel(sceneCtx, kx - 1, ky + 3, '#8b2942');
            drawPixel(sceneCtx, kx - 1, ky + 4, '#7a2238');
            drawPixel(sceneCtx, kx - 1, ky + 5, '#6a1a30');
            
            // Torso
            drawPixel(sceneCtx, kx, ky + 4, '#4a5a68');
            drawPixel(sceneCtx, kx + 1, ky + 4, '#5a6a78');
            drawPixel(sceneCtx, kx + 2, ky + 4, '#5a6a78');
            drawPixel(sceneCtx, kx + 3, ky + 4, '#4a5a68');
            
            // Arms (one resting, one holding towards fire)
            drawPixel(sceneCtx, kx + 4, ky + 4, '#5a6a78'); // extended arm
            drawPixel(sceneCtx, kx + 5, ky + 4, '#5a6a78');
            
            // Glove/hand near fire
            drawPixel(sceneCtx, kx + 6, ky + 4, '#4a4a3a');
            
            // Legs (sitting/bent)
            drawPixel(sceneCtx, kx, ky + 5, '#3a4a58');
            drawPixel(sceneCtx, kx + 1, ky + 5, '#4a5a68');
            drawPixel(sceneCtx, kx + 2, ky + 5, '#4a5a68');
            drawPixel(sceneCtx, kx + 3, ky + 5, '#3a4a58');
            
            // Feet
            drawPixel(sceneCtx, kx + 3, ky + 6, '#3a3a3a');
            drawPixel(sceneCtx, kx + 4, ky + 6, '#3a3a3a');
            
            // Sword on ground
            drawPixel(sceneCtx, kx - 3, ky + 8, '#8a8a9a');
            drawPixel(sceneCtx, kx - 2, ky + 8, '#9a9aaa');
            drawPixel(sceneCtx, kx - 1, ky + 8, '#aaaabc');
            drawPixel(sceneCtx, kx, ky + 8, '#9a9aaa');
            drawPixel(sceneCtx, kx + 1, ky + 8, '#c8a050'); // hilt
            drawPixel(sceneCtx, kx + 2, ky + 8, '#a08040'); // grip
            
            // Shield leaning
            drawPixel(sceneCtx, kx - 4, ky + 5, '#5a4a3a');
            drawPixel(sceneCtx, kx - 4, ky + 6, '#6a5a4a');
            drawPixel(sceneCtx, kx - 4, ky + 7, '#6a5a4a');
            drawPixel(sceneCtx, kx - 3, ky + 6, '#8b2942'); // shield emblem
            drawPixel(sceneCtx, kx - 3, ky + 7, '#5a4a3a');
            
            // Subtle breathing animation
            if (frame % 60 < 30) {
                drawPixel(sceneCtx, kx + 1, ky + 3, '#5a6a78');
            } else {
                drawPixel(sceneCtx, kx + 1, ky + 3, '#5f6f7d');
            }
        }

        // Draw campfire
        function drawCampfire(frame) {
            const fx = 42;
            const fy = 47;
            
            // Logs
            drawPixel(sceneCtx, fx - 2, fy + 3, '#4a3020');
            drawPixel(sceneCtx, fx - 1, fy + 3, '#5a4030');
            drawPixel(sceneCtx, fx, fy + 3, '#4a3020');
            drawPixel(sceneCtx, fx + 1, fy + 3, '#5a4030');
            drawPixel(sceneCtx, fx + 2, fy + 3, '#3a2515');
            
            drawPixel(sceneCtx, fx - 1, fy + 4, '#3a2515');
            drawPixel(sceneCtx, fx, fy + 4, '#4a3020');
            drawPixel(sceneCtx, fx + 1, fy + 4, '#3a2515');
            
            // Rocks around fire
            drawPixel(sceneCtx, fx - 3, fy + 3, '#4a4a4a');
            drawPixel(sceneCtx, fx + 3, fy + 3, '#3a3a3a');
            drawPixel(sceneCtx, fx - 2, fy + 4, '#3a3a3a');
            drawPixel(sceneCtx, fx + 2, fy + 4, '#4a4a4a');
            
            // Fire animation (multiple frames)
            const fireColors = {
                core: ['#fff8e0', '#ffefa0', '#ffe880'],
                mid: ['#ffc040', '#ff9020', '#ffb030'],
                outer: ['#ff6010', '#ff4000', '#cc3000']
            };
            
            const f = frame % 12;
            
            // Core flames
            drawPixel(sceneCtx, fx, fy + 2, fireColors.core[f % 3]);
            drawPixel(sceneCtx, fx - 1 + (f % 2), fy + 2, fireColors.core[(f + 1) % 3]);
            
            // Middle flames
            drawPixel(sceneCtx, fx, fy + 1, fireColors.mid[f % 3]);
            drawPixel(sceneCtx, fx - 1, fy + 1, fireColors.mid[(f + 1) % 3]);
            drawPixel(sceneCtx, fx + 1, fy + 1, fireColors.mid[(f + 2) % 3]);
            drawPixel(sceneCtx, fx + (f % 3) - 1, fy + 2, fireColors.mid[f % 3]);
            
            // Outer flames (dancing)
            if (f < 6) {
                drawPixel(sceneCtx, fx, fy, fireColors.outer[f % 3]);
                drawPixel(sceneCtx, fx - 1, fy, fireColors.outer[(f + 1) % 3]);
            } else {
                drawPixel(sceneCtx, fx + 1, fy, fireColors.outer[f % 3]);
                drawPixel(sceneCtx, fx, fy, fireColors.outer[(f + 2) % 3]);
            }
            
            // Top flicker
            if (f % 4 < 2) {
                drawPixel(sceneCtx, fx, fy - 1, fireColors.outer[(f + 1) % 3]);
            }
            if (f % 6 < 2) {
                drawPixel(sceneCtx, fx + (f % 2), fy - 1, fireColors.mid[f % 3]);
            }
        }

        // Draw a simple tree
        function drawTree(x, y, size = 1) {
            // Trunk
            drawPixel(sceneCtx, x, y, '#3a2a1a');
            drawPixel(sceneCtx, x, y - 1, '#3a2a1a');
            
            // Foliage
            const leafColor = '#1a3020';
            const leafColor2 = '#1e3828';
            drawPixel(sceneCtx, x - 1, y - 2, leafColor);
            drawPixel(sceneCtx, x, y - 2, leafColor2);
            drawPixel(sceneCtx, x + 1, y - 2, leafColor);
            drawPixel(sceneCtx, x, y - 3, leafColor);
            drawPixel(sceneCtx, x - 1, y - 3, leafColor2);
            drawPixel(sceneCtx, x + 1, y - 3, leafColor2);
            drawPixel(sceneCtx, x, y - 4, leafColor2);
        }

        // Draw background elements
        function drawBackground() {
            // Distant mountains
            const mountainColor = '#1a1a28';
            const mountainColor2 = '#151520';
            
            for (let x = 0; x < 80; x++) {
                const h1 = Math.sin(x * 0.1) * 5 + 20;
                const h2 = Math.sin(x * 0.15 + 2) * 4 + 25;
                
                for (let y = Math.floor(h1); y < 52; y++) {
                    drawPixel(sceneCtx, x, y, y < 30 ? mountainColor2 : mountainColor);
                }
            }
            
            // Trees in background
            drawTree(8, 48);
            drawTree(15, 49);
            drawTree(62, 48);
            drawTree(70, 49);
            drawTree(75, 47);
        }

        // Main scene draw
        let animFrame = 0;
        function drawScene() {
            sceneCtx.clearRect(0, 0, sceneCanvas.width, sceneCanvas.height);
            
            // Draw layers
            drawBackground();
            drawGround();
            drawKnight(animFrame);
            drawCampfire(animFrame);
            
            animFrame++;
        }

        // Quote rotation
        function showNextQuote() {
            quoteEl.classList.remove('visible');
            
            setTimeout(() => {
                currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
                quoteEl.textContent = quotes[currentQuoteIndex];
                quoteEl.classList.add('visible');
            }, 1500);
        }

        // Main animation loop
        let lastTime = 0;
        let lastEmberTime = 0;
        function animate(time) {
            // Stars
            drawStars(time * 0.001);
            
            // Scene at lower framerate for pixel feel
            if (time - lastTime > 150) {
                drawScene();
                lastTime = time;
            }
            
            // Embers
            if (time - lastEmberTime > 200) {
                if (Math.random() > 0.3) spawnEmber();
                lastEmberTime = time;
            }
            updateEmbers();
            drawEmbers();
            
            requestAnimationFrame(animate);
        }

        // Sound controls
        soundBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            soundOn = !soundOn;
            if (soundOn) {
                audio.play();
                soundBtn.textContent = 'üîä SOUND';
            } else {
                audio.pause();
                soundBtn.textContent = 'üîá MUTED';
            }
        });

        // Start experience
        function startExperience() {
            startOverlay.classList.add('hidden');
            
            if (!audioStarted) {
                audio.volume = 0.4;
                audio.play().catch(() => {
                    // Audio blocked, that's ok
                    soundBtn.textContent = 'üîá MUTED';
                    soundOn = false;
                });
                audioStarted = true;
            }
            
            // Start quote rotation
            quoteEl.textContent = quotes[0];
            setTimeout(() => quoteEl.classList.add('visible'), 500);
            setInterval(showNextQuote, 9000);
        }

        startOverlay.addEventListener('click', startExperience);
        document.addEventListener('keydown', (e) => {
            if (!startOverlay.classList.contains('hidden')) {
                startExperience();
            }
        });

        // Initialize
        window.addEventListener('resize', () => {
            resizeCanvases();
            initStars();
        });

        resizeCanvases();
        initStars();
        requestAnimationFrame(animate);
    </script>
</body>
</html>
